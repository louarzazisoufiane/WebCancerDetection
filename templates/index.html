<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkinCheck</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõ°Ô∏è</text></svg>">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <!-- Plotly -->
    <script src="https://cdn.plot.ly/plotly-2.20.0.min.js"></script>
</head>

<body>

    <div class="app-container">
        <!-- Header -->
        <header class="main-header">
            <div class="brand">
                <div class="brand-icon">
                    <i class="fa-solid fa-user-doctor"></i>
                </div>
                <div class="brand-text">
                    <h1>SkinCheck</h1>
                </div>
            </div>

            <div class="header-actions">
                <a href="/image-analysis/" class="btn btn-secondary" style="border-top: 4px solid var(--danger-color);">
                    <i class="fa-solid fa-camera" style="color: var(--danger-color);"></i> Analyse Image
                </a>
                <a href="/dashboard/" class="btn btn-secondary" style="border-top: 4px solid var(--success-color);">
                    <i class="fa-solid fa-chart-pie" style="color: var(--success-color);"></i> Dashboard
                </a>
                <a href="/admin/" class="btn btn-secondary" style="border-top: 4px solid var(--primary-color);">
                    <i class="fa-solid fa-lock" style="color: var(--primary-color);"></i> Admin
                </a>
            </div>
        </header>

        <!-- Stats Overview Removed -->

        <!-- Main Grid -->
        <main class="content-grid">

            <!-- Main Form Section -->
            <section class="form-section">
                <div class="card card-accent-primary" id="formCard">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fa-solid fa-clipboard-list"
                                style="margin-right: 8px; color: var(--primary-color);"></i>
                            Donn√©es Patient
                        </div>
                    </div>

                    <form id="cancerForm" action="/api/predict" method="POST">

                        <!-- Model Selection -->
                        <div class="form-group"
                            style="margin-bottom: 2rem; padding: 1rem; background: var(--primary-light); border-radius: var(--radius-md); border-left: 4px solid var(--primary-color);">
                            <label class="form-label" for="model_choice"
                                style="font-weight: 600; color: var(--primary-color);">
                                <i class="fa-solid fa-brain"></i> Mod√®le de Classification
                            </label>
                            <select id="model_choice" name="model_choice" class="form-control form-select"
                                style="margin-top: 0.5rem;">
                                <option value="random_forest" selected>Random Forest (Recommand√©)</option>
                                <option value="gradient_boosting">Gradient Boosting</option>
                                <option value="log_reg">R√©gression Logistique</option>
                                <option value="knn">K-Nearest Neighbors</option>
                            </select>
                            <small
                                style="color: var(--neutral-600); font-size: 0.85rem; margin-top: 0.5rem; display: block;">
                                Random Forest offre g√©n√©ralement la meilleure pr√©cision pour ce type d'analyse.
                            </small>
                        </div>

                        <!-- Global Grid Container for Horizontal Layout -->
                        <div class="grid-4">

                            <!-- Group 1: General Info -->
                            <div class="form-group">
                                <label class="form-label" for="Sex">Sexe</label>
                                <select id="Sex" name="Sex" class="form-control form-select">
                                    <option value="Male">Homme</option>
                                    <option value="Female">Femme</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="AgeCategory">√Çge</label>
                                <select id="AgeCategory" name="AgeCategory" class="form-control form-select">
                                    <option>18-24</option>
                                    <option>25-29</option>
                                    <option>30-34</option>
                                    <option>35-39</option>
                                    <option>40-44</option>
                                    <option>45-49</option>
                                    <option>50-54</option>
                                    <option>55-59</option>
                                    <option>60-64</option>
                                    <option>65-69</option>
                                    <option>70-74</option>
                                    <option>75-79</option>
                                    <option>80 or older</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="BMI">IMC</label>
                                <div class="input-group">
                                    <input type="text" id="BMI" name="BMI" class="form-control" placeholder="24.5"
                                        required>
                                    <span class="input-suffix">kg/m¬≤</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="GenHealth">Sant√© G√©n√©rale</label>
                                <select id="GenHealth" name="GenHealth" class="form-control form-select">
                                    <option>Excellent</option>
                                    <option>Very good</option>
                                    <option>Good</option>
                                    <option>Fair</option>
                                    <option>Poor</option>
                                </select>
                            </div>

                            <!-- Group 2: Lifestyle -->
                            <div class="form-group">
                                <label class="form-label" for="Smoking">Fumeur</label>
                                <select id="Smoking" name="Smoking" class="form-control form-select">
                                    <option value="No">Non</option>
                                    <option value="Yes">Oui</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="PhysicalActivity">Sport</label>
                                <select id="PhysicalActivity" name="PhysicalActivity" class="form-control form-select">
                                    <option value="Yes">Oui</option>
                                    <option value="No">Non</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="SleepTime">Sommeil (h)</label>
                                <input type="number" id="SleepTime" name="SleepTime" class="form-control" value="7"
                                    min="0" max="24">
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="DiffWalking">Difficult√© Marche</label>
                                <select id="DiffWalking" name="DiffWalking" class="form-control form-select">
                                    <option value="No">Non</option>
                                    <option value="Yes">Oui</option>
                                </select>
                            </div>

                            <!-- Group 3: Pathologies (Compact) -->
                            <div class="form-group">
                                <label class="form-label" for="HeartDisease">C≈ìur</label>
                                <select id="HeartDisease" name="HeartDisease" class="form-control form-select">
                                    <option value="No">Non</option>
                                    <option value="Yes">Oui</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="Asthma">Asthme</label>
                                <select id="Asthma" name="Asthma" class="form-control form-select">
                                    <option value="No">Non</option>
                                    <option value="Yes">Oui</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="KidneyDisease">Rein</label>
                                <select id="KidneyDisease" name="KidneyDisease" class="form-control form-select">
                                    <option value="No">Non</option>
                                    <option value="Yes">Oui</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="Stroke">AVC</label>
                                <select id="Stroke" name="Stroke" class="form-control form-select">
                                    <option value="No">Non</option>
                                    <option value="Yes">Oui</option>
                                </select>
                            </div>

                            <!-- Group 4: Other -->
                            <div class="form-group">
                                <label class="form-label" for="Diabetic">Diab√®te</label>
                                <select id="Diabetic" name="Diabetic" class="form-control form-select">
                                    <option value="No">Non</option>
                                    <option value="Yes">Oui</option>
                                    <option value="No, borderline">Pr√©-diab√®te</option>
                                    <option value="Yes (pregnancy)">Oui (Grossesse)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="PhysicalHealth">Jours Malade (Phys)</label>
                                <input type="number" id="PhysicalHealth" name="PhysicalHealth" class="form-control"
                                    value="0" min="0" max="30">
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="MentalHealth">Jours Malade (Men)</label>
                                <input type="number" id="MentalHealth" name="MentalHealth" class="form-control"
                                    value="0" min="0" max="30">
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="Race">Race</label>
                                <select id="Race" name="Race" class="form-control form-select">
                                    <option>White</option>
                                    <option>Black</option>
                                    <option>Asian</option>
                                    <option>Other</option>
                                </select>
                            </div>

                        </div> <!-- End grid-4 -->

                        <div style="margin-top: 1.5rem; display: flex; justify-content: flex-end;">
                            <button type="submit" class="btn btn-primary"
                                style="padding: 0.75rem 3rem; font-size: 1.1rem;">
                                <i class="fa-solid fa-microscope"></i> Lancer l'Analyse
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Result Section - Now Horizontal at Bottom -->
            <section class="result-section" style="margin-top: 0;">
                <div id="resultCard" class="result-card"
                    style="width: 100%; max-width: 800px; margin: 0 auto; display: none;">
                    <div class="result-header">
                        <h3 class="result-title">R√©sultat de l'Analyse</h3>
                        <div id="resultStatus" class="prediction-badge safe">En Attente</div>
                    </div>

                    <div class="result-body"
                        style="display: flex; gap: 2rem; align-items: center; justify-content: center; flex-wrap: wrap;">
                        <!-- Probability Meter -->
                        <div class="probability-meter" style="margin: 0;">
                            <svg viewBox="0 0 36 36" class="circular-chart">
                                <path class="circle-bg"
                                    d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831">
                                </path>
                                <path id="probCircle" class="circle" stroke-dasharray="0, 100"
                                    d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                    stroke="#10b981"></path>
                                <text x="18" y="20.35" class="percentage" id="probText">0%</text>
                            </svg>
                            <div class="text-center"
                                style="margin-top: -10px; font-size: 0.8rem; color: var(--neutral-500); text-align: center;">
                                Probabilit√© de Risque</div>
                        </div>

                        <!-- SHAP Explanation Area -->
                        <!-- SHAP Explanation Area -->
                        <div id="explanation-block" class="explanation-box" style="flex: 1; min-width: 300px;">

                            <!-- Tabs -->
                            <div class="xai-tabs"
                                style="display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid var(--neutral-200);">
                                <button class="tab-btn active" data-tab="shap" onclick="UI.switchTab('shap')"
                                    style="padding: 8px 16px; border: none; background: none; font-weight: 600; color: var(--primary-color); border-bottom: 2px solid var(--primary-color); cursor: pointer;">
                                    SHAP (Global)
                                </button>
                                <button class="tab-btn" data-tab="lime" onclick="UI.switchTab('lime')"
                                    style="padding: 8px 16px; border: none; background: none; font-weight: 500; color: var(--neutral-500); cursor: pointer;">
                                    LIME (Local)
                                </button>
                            </div>

                            <!-- SHAP Container -->
                            <div id="shap-container">
                                <p style="text-align: center; color: var(--neutral-400); font-style: italic;">
                                    Les d√©tails SHAP appara√Ætront ici.
                                </p>
                            </div>

                            <!-- LIME Container -->
                            <div id="lime-container" style="display: none;">
                                <p style="text-align: center; color: var(--neutral-400); font-style: italic;">
                                    Les d√©tails LIME appara√Ætront ici.
                                </p>
                            </div>

                        </div>
                    </div>

                    <!-- Actions -->
                    <div id="resultActions" class="mt-4 hidden"
                        style="padding: 1.5rem; border-top: 1px solid var(--neutral-200); text-align: center;">
                        <button id="generate-report-btn" class="btn btn-accent" style="min-width: 250px;">
                            <i class="fa-solid fa-file-pdf"></i> T√©l√©charger le Rapport
                        </button>
                    </div>
                </div>

                <!-- Intro Card replaced by simple text if needed, or hidden -->
            </section>

        </main>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='form.js') }}"></script>
</body>

</html>